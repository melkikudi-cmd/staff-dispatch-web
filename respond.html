<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Worker Response Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; background:#0f172a; color:white; margin:0; }
    header { background:#020617; padding:20px; text-align:center; font-size:24px; }
    .container { padding:20px; max-width:900px; margin:auto; }
    .assignment-card { background:#020617; padding:15px; border-radius:10px; border:1px solid #1e293b; margin-bottom:15px; }
    button { margin-right:10px; padding:6px 12px; border:none; border-radius:5px; cursor:pointer; font-weight:bold; }
    .accept { background:#22c55e; color:white; }
    .decline { background:#ef4444; color:white; }
  </style>
</head>
<body>

<header>Worker Response Dashboard</header>

<div class="container" id="assignments-container">
  <p>Loading assignments...</p>
</div>

<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

  const supabaseUrl = 'https://rplmbuoyjlpcxskmtlzk.supabase.co'
  const supabaseKey = 'sb_publishable_Ghw5xJ5IoGL2EzlCHCKLLQ_gWZPryTD'
  const supabase = createClient(supabaseUrl, supabaseKey)

  async function fetchAssignments() {
    const { data, error } = await supabase
      .from('worker_assignments')
      .select('id, status, assigned_at, workers(name), events(title, date)')
    
    const container = document.getElementById('assignments-container')
    container.innerHTML = ''
    
    if (error) {
      container.innerHTML = `<p>Error loading assignments: ${error.message}</p>`
      return
    }

    if (!data.length) {
      container.innerHTML = '<p>No assignments at the moment.</p>'
      return
    }

    data.forEach(item => {
      const card = document.createElement('div')
      card.className = 'assignment-card'
      card.innerHTML = `
        <p><strong>Event:</strong> ${item.events.title} (${item.events.date})</p>
        <p><strong>Worker:</strong> ${item.workers.name}</p>
        <p><strong>Status:</strong> ${item.status}</p>
        <button class="accept">Accept</button>
        <button class="decline">Decline</button>
      `

      card.querySelector('.accept').onclick = () => respond(item.id, 'accepted')
      card.querySelector('.decline').onclick = () => respond(item.id, 'declined')

      container.appendChild(card)
    })
  }

  async function respond(assignmentId, newStatus) {
    await supabase
      .from('worker_assignments')
      .update({ status: newStatus })
      .eq('id', assignmentId)
    
    fetchAssignments() // Refresh
  }

  fetchAssignments()
</script>

</body>
</html>
